$(document).ready(function() {
	if(phoneMask) {
		maskAll = phoneMask;//'+7 (###) ### ##-##,+380 (##) ### ##-##,+375 (##) ### ##-##';
		mask = '+# (###) ### ##-##';
		savePos = 1;
		tmpInputVal = '';

		// ставим плейсхолдер
		tmpMask = maskAll.split(',');
		$('[name=phone]').attr('placeholder', tmpMask[0].replace(/#/g, '_'));
		delete tmpMask

		// устанавливаем маску при фокусе
		$('body').on('focus', '[name=phone]', function() {
			if($(this).val().indexOf('_') != -1 || $(this).val() == '') {
				tmpMask = maskAll.split(',');
				$(this).val(tmpMask[0].replace(/#/g, '_'));
				delete tmpMask;
			}
		});

		// сбрасываем маску и номер, если ничего не введено или не введено до конца
		$('body').on('blur', '[name=phone]', function() {
			if($(this).val().indexOf('_') != -1) {
				$(this).val('');
			}
		});

		$('body').on('input', '[name=phone]', function() {
			// начальное определение того, что происходит
			input = $(this);
			if(tmpInputVal.length < input.val().length) {
				add = true;
			} else {
				add = false;
			}
			savePos = input.get(0).selectionStart;
			phone = input.val().replace(/[^0-9]/g, '');
			newPhone = '';
			// определяем нужную маску
			masks = maskAll.split(',');
			for (i = 0; i < masks.length; i++) {
				mask = '+# (###) ### ##-##';
				maskNumber = masks[i].replace(/[^0-9]/g, '');
				if(maskNumber == phone.substring(0, maskNumber.length)) {
					mask = masks[i].replace(/[0-9]/g, '#');
					i = 1000000;
				}
			}
			// подготовка нового телефона по шаблону
			setCursor = true;
			for(i = 0, counter = 0; i < mask.length; i++) {
				if(mask[i] == '#') {
					if(phone[counter] == undefined) {
						newPhone += '_';
						if(add && setCursor) {
							savePos = i;
							setCursor = false;
						}
					} else {
						newPhone += phone[counter];
					}
					counter++;
				} else {
					newPhone += mask[i];
				}			
			}
			// вывод телефона
			input.val(newPhone);
			// установка курсора
			input.get(0).setSelectionRange(savePos, savePos);
			tmpInputVal = newPhone;
		});
	}
});